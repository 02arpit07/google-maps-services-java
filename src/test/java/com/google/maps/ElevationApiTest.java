/*
 * Copyright 2014 Google Inc. All rights reserved.
 *
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this
 * file except in compliance with the License. You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
 * ANY KIND, either express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

package com.google.maps;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

import com.google.maps.errors.InvalidRequestException;
import com.google.maps.errors.RequestDeniedException;
import com.google.maps.model.ElevationResult;
import com.google.maps.model.EncodedPolyline;
import com.google.maps.model.LatLng;
import com.google.maps.model.LatLngAssert;
import com.google.mockwebserver.MockResponse;
import com.google.mockwebserver.MockWebServer;

import java.util.List;
import org.junit.After;
import org.junit.Test;
import org.junit.experimental.categories.Category;

import java.util.Collections;

@Category(MediumTests.class)
public class ElevationApiTest {

  public static final double SYDNEY_ELEVATION = 19.11174774169922;
  public static final double SYDNEY_POINT_ELEVATION = 19.10829925537109;
  public static final double MELBOURNE_ELEVATION = 25.49982643127441;
  private static final double EPSILON = .00001;
  private static final LatLng SYDNEY = new LatLng(-33.867487, 151.206990);
  private static final LatLng MELBOURNE = new LatLng(-37.814107, 144.963280);
  private static final EncodedPolyline SYD_MELB_ROUTE = new EncodedPolyline(
      "rvumEis{y[`NsfA~tAbF`bEj^h{@{KlfA~eA~`AbmEghAt~D|e@jlRpO~yH_\\v}LjbBh~FdvCxu@`nCplDbcBf_B|w"
          + "BhIfhCnqEb~D~jCn_EngApdEtoBbfClf@t_CzcCpoEr_Gz_DxmAphDjjBxqCviEf}B|pEvsEzbE~qGfpExjBlqCx}"
          + "BvmLb`FbrQdpEvkAbjDllD|uDldDj`Ef|AzcEx_Gtm@vuI~xArwD`dArlFnhEzmHjtC~eDluAfkC|eAdhGpJh}N_m"
          + "ArrDlr@h|HzjDbsAvy@~~EdTxpJje@jlEltBboDjJdvKyZpzExrAxpHfg@pmJg[tgJuqBnlIarAh}DbN`hCeOf_Ib"
          + "xA~uFt|A|xEt_ArmBcN|sB|h@b_DjOzbJ{RlxCcfAp~AahAbqG~Gr}AerA`dCwlCbaFo]twKt{@bsG|}A~fDlvBvz"
          + "@tw@rpD_r@rqB{PvbHek@vsHlh@ptNtm@fkD[~xFeEbyKnjDdyDbbBtuA|~Br|Gx_AfxCt}CjnHv`Ew\\lnBdrBfq"
          + "BraD|{BldBxpG|]jqC`mArcBv]rdAxgBzdEb{InaBzyC}AzaEaIvrCzcAzsCtfD~qGoPfeEh]h`BxiB`e@`kBxfAv"
          + "^pyA`}BhkCdoCtrC~bCxhCbgEplKrk@tiAteBwAxbCwuAnnCc]b{FjrDdjGhhGzfCrlDruBzSrnGhvDhcFzw@n{@z"
          + "xAf}Fd{IzaDnbDjoAjqJjfDlbIlzAraBxrB}K~`GpuD~`BjmDhkBp{@r_AxCrnAjrCx`AzrBj{B|r@~qBbdAjtDnv"
          + "CtNzpHxeApyC|GlfM`fHtMvqLjuEtlDvoFbnCt|@xmAvqBkGreFm~@hlHw|AltC}NtkGvhBfaJ|~@riAxuC~gErwC"
          + "ttCzjAdmGuF`iFv`AxsJftD|nDr_QtbMz_DheAf~Buy@rlC`i@d_CljC`gBr|H|nAf_Fh{G|mE~kAhgKviEpaQnu@"
          + "zwAlrA`G~gFnvItz@j{Cng@j{D{]`tEftCdcIsPz{DddE~}PlnE|dJnzG`eG`mF|aJdqDvoAwWjzHv`H`wOtjGzeX"
          + "hhBlxErfCf{BtsCjpEjtD|}Aja@xnAbdDt|ErMrdFh{CzgAnlCnr@`wEM~mE`bA`uD|MlwKxmBvuFlhB|sN`_@fvB"
          + "p`CxhCt_@loDsS|eDlmChgFlqCbjCxk@vbGxmCjbMba@rpBaoClcCk_DhgEzYdzBl\\vsA_JfGztAbShkGtEhlDzh"
          + "C~w@hnB{e@yF}`D`_Ayx@~vGqn@l}CafC");

  @Test(expected = InvalidRequestException.class)
  public void testGetByPointThrowsInvalidRequestExceptionFromResponse() throws Exception {
    // Queue up an invalid response
    LocalTestServerContext sc = new LocalTestServerContext(""
        + "{\n"
        + "   \"routes\" : [],\n"
        + "   \"status\" : \"INVALID_REQUEST\"\n"
        + "}");

    // This should throw the InvalidRequestException
    ElevationApi.getByPoint(sc.context, new LatLng(0, 0)).await();
  }

  @Test(expected = RequestDeniedException.class)
  public void testGetByPointsThrowsRequestDeniedExceptionFromResponse() throws Exception {
    // Queue up an invalid response
    LocalTestServerContext sc = new LocalTestServerContext(""
        + "{\n"
        + "   \"routes\" : [],\n"
        + "   \"status\" : \"REQUEST_DENIED\",\n"
        + "   \"errorMessage\" : \"Can't do the thing\"\n"
        + "}");

    // This should throw the RequestDeniedException
    ElevationApi.getByPoints(sc.context,
        new EncodedPolyline(Collections.singletonList(new LatLng(0, 0)))).await();
  }

  @Test
  public void testGetPoint() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext(""
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"elevation\" : 19.10829925537109,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -33.867487,\n"
        + "            \"lng\" : 151.20699\n"
        + "         },\n"
        + "         \"resolution\" : 4.771975994110107\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    ElevationResult result = ElevationApi.getByPoint(sc.context, SYDNEY).await();

    assertNotNull(result);
    assertEquals(SYDNEY_POINT_ELEVATION, result.elevation, EPSILON);

    sc.assertParamValue(SYDNEY.toUrlValue(), "locations");
  }

  @Test
  public void testGetPoints() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext(""
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"elevation\" : 19.11174774169922,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -33.86749,\n"
        + "            \"lng\" : 151.20699\n"
        + "         },\n"
        + "         \"resolution\" : 4.771975994110107\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 25.49982643127441,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.81411,\n"
        + "            \"lng\" : 144.96328\n"
        + "         },\n"
        + "         \"resolution\" : 152.7032318115234\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    ElevationResult[] results = ElevationApi.getByPoints(sc.context, SYDNEY, MELBOURNE).await();

    assertNotNull(results);
    assertEquals(2, results.length);
    assertEquals(SYDNEY_ELEVATION, results[0].elevation, EPSILON);
    assertEquals(MELBOURNE_ELEVATION, results[1].elevation, EPSILON);

    sc.assertParamValue("enc:xvumEur{y[jyaWdnbe@", "locations");
  }

  @Test
  public void testGetPath() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext(""
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"elevation\" : 19.11174774169922,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -33.86749,\n"
        + "            \"lng\" : 151.20699\n"
        + "         },\n"
        + "         \"resolution\" : 4.771975994110107\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 456.7416381835938,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.32145720949158,\n"
        + "            \"lng\" : 150.5433152252451\n"
        + "         },\n"
        + "         \"resolution\" : 152.7032318115234\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 677.8786010742188,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.77180578055915,\n"
        + "            \"lng\" : 149.8724504366625\n"
        + "         },\n"
        + "         \"resolution\" : 152.7032318115234\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 672.6239624023438,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.21843425947625,\n"
        + "            \"lng\" : 149.1942540405992\n"
        + "         },\n"
        + "         \"resolution\" : 152.7032318115234\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 1244.74755859375,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.66123890186951,\n"
        + "            \"lng\" : 148.5085849619781\n"
        + "         },\n"
        + "         \"resolution\" : 152.7032318115234\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 317.3624572753906,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.10011364524662,\n"
        + "            \"lng\" : 147.815302885111\n"
        + "         },\n"
        + "         \"resolution\" : 152.7032318115234\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 797.5011596679688,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.53495008485245,\n"
        + "            \"lng\" : 147.1142685138642\n"
        + "         },\n"
        + "         \"resolution\" : 152.7032318115234\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 684.0189819335938,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.9656374532439,\n"
        + "            \"lng\" : 146.4053438519865\n"
        + "         },\n"
        + "         \"resolution\" : 152.7032318115234\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 351.05712890625,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.39206260399896,\n"
        + "            \"lng\" : 145.6883925043725\n"
        + "         },\n"
        + "         \"resolution\" : 152.7032318115234\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 25.49982643127441,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.81411,\n"
        + "            \"lng\" : 144.96328\n"
        + "         },\n"
        + "         \"resolution\" : 152.7032318115234\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    ElevationResult[] results = ElevationApi.getByPath(sc.context, 10, SYDNEY, MELBOURNE).await();

    assertNotNull(results);
    assertEquals(10, results.length);
    assertEquals(SYDNEY_ELEVATION, results[0].elevation, EPSILON);
    assertEquals(MELBOURNE_ELEVATION, results[9].elevation, EPSILON);

    sc.assertParamValue("10", "samples");
    sc.assertParamValue("enc:xvumEur{y[jyaWdnbe@", "path");
  }

  @Test
  public void testDirectionsAlongPath() throws Exception {
    LocalTestServerContext sc = new LocalTestServerContext("\n"
        + "{\n"
        + "   \"results\" : [\n"
        + "      {\n"
        + "         \"elevation\" : 19.30763816833496,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -33.86746,\n"
        + "            \"lng\" : 151.20709\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 13.63531494140625,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -33.93418870760096,\n"
        + "            \"lng\" : 151.2048109521581\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 22.67794799804688,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -33.93611348767503,\n"
        + "            \"lng\" : 151.1179499439254\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 25.5423412322998,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -33.94179099529389,\n"
        + "            \"lng\" : 151.0248274293727\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 12.80434608459473,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -33.93988322412878,\n"
        + "            \"lng\" : 150.931696721774\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 65.37848663330078,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -33.98155290568498,\n"
        + "            \"lng\" : 150.8655331001279\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 67.65006256103516,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.04267539606656,\n"
        + "            \"lng\" : 150.8155353482151\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 99.75529479980469,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.10401673708059,\n"
        + "            \"lng\" : 150.7623006399985\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 130.8006286621094,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.17605223765933,\n"
        + "            \"lng\" : 150.7294790364836\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 193.3520812988281,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.23305557476613,\n"
        + "            \"lng\" : 150.6668251612414\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 334.890625,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.29700428521164,\n"
        + "            \"lng\" : 150.6171258096405\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 485.6658325195312,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.35004990313182,\n"
        + "            \"lng\" : 150.5499644903976\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 603.6323852539062,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.41241440700556,\n"
        + "            \"lng\" : 150.4952284048991\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 675.9644165039062,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.4425741790337,\n"
        + "            \"lng\" : 150.4096270725346\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 658.4600219726562,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.47487561563866,\n"
        + "            \"lng\" : 150.3242324292161\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 641.0990600585938,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.54012551377705,\n"
        + "            \"lng\" : 150.2781951681288\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 694.635986328125,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.60508569100411,\n"
        + "            \"lng\" : 150.229317759589\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 683.1285400390625,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.63561797380088,\n"
        + "            \"lng\" : 150.147123900314\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 616.5374145507812,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.66987222591835,\n"
        + "            \"lng\" : 150.0636921407473\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 633.684814453125,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.72187320232963,\n"
        + "            \"lng\" : 149.9942253301121\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 646.775146484375,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.743529011363,\n"
        + "            \"lng\" : 149.9060607952434\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 656.656005859375,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.7338380169955,\n"
        + "            \"lng\" : 149.8157680392622\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 682.2879028320312,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.77210959328304,\n"
        + "            \"lng\" : 149.7456782656556\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 680.8931884765625,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.7832929886516,\n"
        + "            \"lng\" : 149.6528497589898\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 706.8088989257812,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.80673626202241,\n"
        + "            \"lng\" : 149.5671441481079\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 727.0847778320312,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.81135441254698,\n"
        + "            \"lng\" : 149.4748764248162\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 729.56591796875,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.8216651455622,\n"
        + "            \"lng\" : 149.3821142460862\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 627.5591430664062,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.80186730894788,\n"
        + "            \"lng\" : 149.2919867131641\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 619.4981079101562,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.7875348306532,\n"
        + "            \"lng\" : 149.2024032949869\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 576.5390014648438,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.81288310427085,\n"
        + "            \"lng\" : 149.1153681417341\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 647.2942504882812,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.83132236414112,\n"
        + "            \"lng\" : 149.0274384225476\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 554.2569580078125,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.81571513403354,\n"
        + "            \"lng\" : 148.9393149032084\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 527.8458862304688,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.78635978622274,\n"
        + "            \"lng\" : 148.8557881679657\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 586.5067749023438,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.76745588966663,\n"
        + "            \"lng\" : 148.7675650274979\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 520.2943725585938,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.80467055620268,\n"
        + "            \"lng\" : 148.6906520279299\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 499.1740112304688,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.81021493018572,\n"
        + "            \"lng\" : 148.6064691468771\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 531.8472900390625,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.80496951098601,\n"
        + "            \"lng\" : 148.5130627933494\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 386.6448364257812,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.81641481079129,\n"
        + "            \"lng\" : 148.4204208554565\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 285.3293151855469,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.81837143946927,\n"
        + "            \"lng\" : 148.3277303062406\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 334.1597595214844,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.87074129947463,\n"
        + "            \"lng\" : 148.2603507834795\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 322.6882019042969,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.90957545829352,\n"
        + "            \"lng\" : 148.1787275023388\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 228.2541961669922,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -34.97216511599062,\n"
        + "            \"lng\" : 148.1428830649462\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 262.6902770996094,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.04018484475662,\n"
        + "            \"lng\" : 148.1083624817241\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 215.5640106201172,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.10330250149316,\n"
        + "            \"lng\" : 148.0614841554738\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 255.7534332275391,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.14370728056297,\n"
        + "            \"lng\" : 147.9828802039315\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 323.3035278320312,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.16387704544926,\n"
        + "            \"lng\" : 147.8962708213743\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 292.5396118164062,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.19264418422875,\n"
        + "            \"lng\" : 147.819233233818\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 229.7057495117188,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.24995530328722,\n"
        + "            \"lng\" : 147.759766967826\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 249.7723846435547,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.30173071741712,\n"
        + "            \"lng\" : 147.6907110899704\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 285.0657958984375,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.35771005392223,\n"
        + "            \"lng\" : 147.6587574936025\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 414.4817199707031,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.42739859717759,\n"
        + "            \"lng\" : 147.6359161487572\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 383.9430847167969,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.48551703499704,\n"
        + "            \"lng\" : 147.5732820137972\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 346.4050598144531,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.55464686491273,\n"
        + "            \"lng\" : 147.5343630171953\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 298.9681091308594,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.61686403410487,\n"
        + "            \"lng\" : 147.4864667121691\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 276.23583984375,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.66800970866227,\n"
        + "            \"lng\" : 147.4173724086339\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 288.7292175292969,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.69858525987858,\n"
        + "            \"lng\" : 147.3309629877854\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 291.6640625,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.76198440962613,\n"
        + "            \"lng\" : 147.2879959994351\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 301.1924438476562,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.82302076537403,\n"
        + "            \"lng\" : 147.2368530279028\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 268.1228637695312,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.87993886641533,\n"
        + "            \"lng\" : 147.1784480103171\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 264.8238220214844,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.91575112873619,\n"
        + "            \"lng\" : 147.1053279493547\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 195.01171875,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.92848814594905,\n"
        + "            \"lng\" : 147.0133718704994\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 221.6598510742188,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -35.99763788065796,\n"
        + "            \"lng\" : 146.9919283632397\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 170.7210388183594,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.06274814599447,\n"
        + "            \"lng\" : 146.9443464803252\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 156.9263305664062,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.10791161250052,\n"
        + "            \"lng\" : 146.8793117774146\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 160.6368560791016,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.08216108899676,\n"
        + "            \"lng\" : 146.791424792249\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 192.1187133789062,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.09478012137878,\n"
        + "            \"lng\" : 146.6990218443442\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 229.2239837646484,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.14875008812928,\n"
        + "            \"lng\" : 146.6313742464744\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 217.0271759033203,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.16667405203486,\n"
        + "            \"lng\" : 146.542015594317\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 196.7459106445312,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.20040696375381,\n"
        + "            \"lng\" : 146.4616367372034\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 163.3575897216797,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.26550527472256,\n"
        + "            \"lng\" : 146.4096523018605\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 155.342041015625,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.33473356340676,\n"
        + "            \"lng\" : 146.3779072778888\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 151.7095184326172,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.39368985502084,\n"
        + "            \"lng\" : 146.3338489588857\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 159.3297119140625,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.43279405447412,\n"
        + "            \"lng\" : 146.2548693194679\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 178.6408538818359,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.47254077525418,\n"
        + "            \"lng\" : 146.1810937405232\n"
        + "         },\n"
        + "         \"resolution\" : 1221.625854492188\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 174.1010894775391,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.50209154565792,\n"
        + "            \"lng\" : 146.0921804414509\n"
        + "         },\n"
        + "         \"resolution\" : 1221.625854492188\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 176.1711883544922,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.55318572207888,\n"
        + "            \"lng\" : 146.0270619642694\n"
        + "         },\n"
        + "         \"resolution\" : 1221.625854492188\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 192.8383331298828,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.58068739645458,\n"
        + "            \"lng\" : 145.9405445365641\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 196.5705108642578,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.60004083342037,\n"
        + "            \"lng\" : 145.8524401189636\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 185.3541564941406,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.62383329585564,\n"
        + "            \"lng\" : 145.7624977977077\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 189.3662567138672,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.66718286754705,\n"
        + "            \"lng\" : 145.6833754964888\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 176.9458923339844,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.72523774478365,\n"
        + "            \"lng\" : 145.6203106790113\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 191.1588439941406,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.77390071575151,\n"
        + "            \"lng\" : 145.5583808108557\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 190.0719299316406,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.79953629048179,\n"
        + "            \"lng\" : 145.4726208374354\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 251.2273559570312,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.83492170950757,\n"
        + "            \"lng\" : 145.3870666184597\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 186.9484100341797,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.86601888447853,\n"
        + "            \"lng\" : 145.2985466452995\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 154.44140625,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.91810954144704,\n"
        + "            \"lng\" : 145.228457593862\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 168.3538665771484,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -36.97597292239033,\n"
        + "            \"lng\" : 145.1688516659076\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 152.7733459472656,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.02064152105597,\n"
        + "            \"lng\" : 145.1065442755132\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 205.2728881835938,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.0966355473582,\n"
        + "            \"lng\" : 145.0926706344683\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 232.0518951416016,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.17290416911895,\n"
        + "            \"lng\" : 145.077242539156\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 245.8816528320312,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.24759995164867,\n"
        + "            \"lng\" : 145.0533485684018\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 337.6495666503906,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.32267999335172,\n"
        + "            \"lng\" : 145.0412333831331\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 363.9090270996094,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.39392122874037,\n"
        + "            \"lng\" : 145.0186364431291\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 336.326171875,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.46285875964947,\n"
        + "            \"lng\" : 144.9755824884678\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 225.3623809814453,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.5362375403782,\n"
        + "            \"lng\" : 144.9483133577448\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 176.9776916503906,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.60518203922306,\n"
        + "            \"lng\" : 144.9703434568565\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 114.5188903808594,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.67481088443494,\n"
        + "            \"lng\" : 144.9846098878599\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 69.74943542480469,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.69489825647631,\n"
        + "            \"lng\" : 144.9072009653025\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 39.91798400878906,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.74259617351967,\n"
        + "            \"lng\" : 144.932710993307\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      },\n"
        + "      {\n"
        + "         \"elevation\" : 31.31394958496094,\n"
        + "         \"location\" : {\n"
        + "            \"lat\" : -37.81413000000006,\n"
        + "            \"lng\" : 144.9631799999999\n"
        + "         },\n"
        + "         \"resolution\" : 610.8129272460938\n"
        + "      }\n"
        + "   ],\n"
        + "   \"status\" : \"OK\"\n"
        + "}\n");
    ElevationResult[] elevation = ElevationApi.getByPath(sc.context, 100, SYD_MELB_ROUTE).await();
    assertEquals(100, elevation.length);

    List<LatLng> overviewPolylinePath = SYD_MELB_ROUTE.decodePath();
    LatLng lastDirectionsPoint = overviewPolylinePath.get(overviewPolylinePath.size() - 1);
    LatLng lastElevationPoint = elevation[elevation.length - 1].location;

    LatLngAssert.assertEquals(lastDirectionsPoint, lastElevationPoint, EPSILON);

    sc.assertParamValue("100", "samples");
    sc.assertParamValue("enc:" + SYD_MELB_ROUTE.getEncodedPath(), "path");
  }

}
